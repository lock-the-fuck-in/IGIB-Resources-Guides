<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Max Gum - Personal Portfolio</title>
    <!-- FIX: Corrected the Tailwind CSS script URL -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'serif': ['Playfair Display', 'serif'],
                    },
                    colors: {
                        'brand-dark': '#0a0a0a',
                        'brand-gold': '#a88a53',
                        'brand-light': '#f0f0f0',
                        'brand-gray': '#888888',
                    },
                    animation: {
                        'fade-in-down': 'fadeInDown 1s ease-out forwards',
                        'fade-in-up': 'fadeInUp 1s ease-out forwards',
                        'subtle-slide': 'subtleSlide 1.5s ease-out forwards',
                        'subtle-glow': 'subtleGlow 4s ease-in-out infinite',
                        'float-up': 'floatUp 3.5s ease-in-out infinite',
                        'float-down': 'floatDown 3.5s ease-in-out infinite',
                    },
                    keyframes: {
                        fadeInDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        subtleSlide: {
                            '0%': { opacity: '0', transform: 'translateX(-40px)' },
                            '100%': { opacity: '1', transform: 'translateX(0)' },
                        },
                        subtleGlow: {
                            '0%, 100%': { 
                                'text-shadow': '0 0 8px rgba(168, 138, 83, 0.5), 0 0 12px rgba(168, 138, 83, 0.3)' 
                            },
                            '50%': { 
                                'text-shadow': '0 0 12px rgba(168, 138, 83, 0.7), 0 0 20px rgba(168, 138, 83, 0.5)' 
                            },
                        },
                        floatUp: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        },
                        floatDown: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(5px)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Base Styles */
        html {
            scroll-behavior: smooth;
            /* Hide scrollbar for Firefox */
            scrollbar-width: none;
        }
        body {
            background-color: #0a0a0a;
            color: #f0f0f0;
            font-family: 'Inter', sans-serif;
            /* Hide scrollbar for Chrome, Safari and Opera */
            -ms-overflow-style: none; /* IE and Edge */
        }
        
        body::-webkit-scrollbar {
            display: none;
        }

        /* Header Styling */
        .header {
            transition: background-color 0.3s ease-in-out, padding 0.3s ease-in-out;
        }
        .header-scrolled {
            background-color: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            padding-top: 1.25rem;
            padding-bottom: 1.25rem;
        }

        /* Profile Image */
        .profile-image-container {
            width: 150px;
            height: 150px;
            border-radius: 9999px;
            overflow: hidden;
            border: 3px solid #a88a53;
            box-shadow: 0 0 15px rgba(168, 138, 83, 0.5);
            margin-bottom: 1.5rem;
        }
        .profile-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Activity Card */
        .activity-card {
            padding: 32px;
            border: 1px solid #222;
            background-color: #0a0a0a;
            border-radius: 12px;
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        .activity-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 30px rgba(168, 138, 83, 0.1);
            border-color: #a88a53;
        }

        /* Skill Badge */
        .skill-badge {
            display: inline-block;
            padding: 8px 16px;
            border: 1px solid #333;
            border-radius: 20px;
            font-size: 0.875rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .skill-badge:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(168, 138, 83, 0.1);
            border-color: #a88a53;
            color: #a88a53;
        }

        /* Scroll Animations */
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s cubic-bezier(0.5, 0, 0, 1), transform 0.8s cubic-bezier(0.5, 0, 0, 1);
        }
        .reveal.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* --- Gemini Modal Styles --- */
        .gemini-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            z-index: 100;
            display: none; /* Hidden by default */
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .gemini-modal-overlay.is-visible {
            display: flex;
            opacity: 1;
        }

        .gemini-modal {
            background-color: #0a0a0a;
            border: 1px solid #222;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            padding: 32px;
            box-shadow: 0 10px 40px rgba(168, 138, 83, 0.2);
            position: relative;
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.3s ease-in-out;
        }
        .gemini-modal-overlay.is-visible .gemini-modal {
            transform: scale(1);
            opacity: 1;
        }

        .gemini-modal-close {
            position: absolute;
            top: 16px;
            right: 16px;
            color: #888888;
            font-size: 24px;
            line-height: 1;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .gemini-modal-close:hover {
            color: #f0f0f0;
        }

        .gemini-input, .gemini-textarea {
            width: 100%;
            background-color: #1a1a1a;
            border: 1px solid #333;
            color: #f0f0f0;
            border-radius: 8px;
            padding: 12px;
            font-family: 'Inter', sans-serif;
            margin-bottom: 16px;
            transition: border-color 0.2s ease;
        }
        .gemini-input:focus, .gemini-textarea:focus {
            border-color: #a88a53;
            outline: none;
        }
        
        /* Validation Error Style */
        .gemini-input.invalid {
            border-color: #ef4444; /* Red border for error */
        }

        .gemini-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .gemini-button {
            background-color: #a88a53;
            color: #0a0a0a;
            font-weight: bold;
            padding: 12px 24px;
            border-radius: 9999px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .gemini-button:hover {
            background-color: #c0a068;
            transform: translateY(-2px);
        }
        .gemini-button.secondary {
            background-color: #222;
            color: #f0f0f0;
        }
        .gemini-button.secondary:hover {
            background-color: #333;
        }

        /* Loading Spinner */
        .gemini-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f0f0f0;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        .gemini-button .gemini-spinner {
            border: 2px solid #0a0a0a;
            border-top-color: transparent;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

    </style>
</head>
<body class="bg-brand-dark">

    <!-- Header -->
    <header class="header fixed w-full top-0 left-0 z-50 px-6 sm:px-8 py-6">
        <div class="container mx-auto max-w-6xl flex justify-between items-center">
            <a href="#" class="font-serif text-2xl font-bold text-white">Max Gum</a>
            <nav>
                <a href="#about" class="text-brand-gray hover:text-white ml-6">About</a>
                <a href="#ventures" class="text-brand-gray hover:text-white ml-6">Ventures</a>
                <a href="#contact" class="text-brand-gray hover:text-white ml-6">Contact</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>

        <!-- Hero Section -->
        <section class="hero-section min-h-screen flex flex-col overflow-hidden">
            
            <!-- Video Banner -->
            <div class="relative w-full h-[50vh] overflow-hidden">
                <!-- 
                    USER ACTION REQUIRED: 
                    1. Create a folder named 'assets' in the same directory as this index.html file.
                    2. Place your video file inside it (e.g., 'assets/video-loop.mp4').
                    3. Update the 'src' attribute below to match your video file's name.
                -->
                <video class="absolute top-0 left-0 w-full h-full object-cover" 
                       poster="https://placehold.co/1920x540/0a0a0a/111111?text=Loading+Video..." 
                       autoplay 
                       loop 
                       muted 
                       playsinline
                       src="assets/video-loop.mp4"> <!-- UPDATE THIS PATH -->
                </video>
                <!-- Video Overlay -->
                <div class="absolute inset-0 bg-brand-dark opacity-30"></div>
            </div>

            <!-- Hero Content -->
            <div class="hero-content container mx-auto max-w-6xl text-center py-16 sm:py-20"> <!-- Changed to text-center -->
                <h1 class="font-serif text-6xl sm:text-8xl md:text-9xl font-bold text-white animate-fade-in-down animate-subtle-glow" style="animation-delay: 0.2s;">
                    <span class="inline-block animate-float-up">Max</span>
                    <span class="inline-block animate-float-down">Gum</span>
                </h1>
                <p class="font-sans text-xl sm:text-2xl text-brand-light opacity-90 animate-fade-in-down" style="animation-delay: 0.5s;">
                    Student Entrepreneur. Founder. Engineer in Training.
                </p>
            </div>
        </section>


        <!-- About Me Section -->
        <section id="about" class="py-20 md:py-32 px-6 sm:px-8">
            <div class="container mx-auto max-w-6xl grid grid-cols-1 md:grid-cols-3 gap-12">
                
                <!-- Left Column (Image & Title) -->
                <div class="md:col-span-1 reveal flex flex-col items-center md:items-start">
                    <div class="profile-image-container">
                        <!-- 
                            USER ACTION REQUIRED: 
                            1. Place your profile picture in the 'assets' folder (e.g., 'assets/profile-image.jpg').
                            2. Update the 'src' attribute below to match your image file's name.
                        -->
                        <img src="assets/profile-image.jpg" <!-- UPDATE THIS PATH -->
                             alt="Max Gum profile picture"
                             onerror="this.src='https://placehold.co/200x200/1a1a1a/333333?text=Image+Error';">
                    </div>
                    <h2 class="font-serif text-4xl font-bold text-white mb-4 text-center md:text-left">About Me</h2>
                </div>

                <!-- Right Column (Bio) -->
                <div class="md:col-span-2 reveal" style="transition-delay: 0.2s;">
                    <p class="font-sans text-lg text-brand-light mb-6">
                        Born in Warsaw, Poland, my global journey began at three months old in New York City. After five years, I returned to Poland for my early education before moving to Istanbul, Turkey, in 2019.
                    </p>
                    <p class="font-sans text-lg text-brand-light mb-6">
                        In Istanbul, I attended a private British school, broadening my horizons and meeting people from diverse industries. Inspired by these experiences, I launched my own venture, Migmag.
                    </p>
                    <p class="font-sans text-lg text-brand-light mb-6">
                        I am an ambitious and disciplined student, an IB graduate now pursuing Electrical Engineering at Warsaw University of Technology. My focus is on business, entrepreneurship, and sales, and I am committed to developing real-world skills and turning ideas into action.
                    </p>
                    <p class="font-sans text-lg text-brand-light">
                        I am dedicated to continuous growth through hands-on experience, always pushing beyond my comfort zone to improve and achieve my goals.
                    </p>
                </div>
            </div>
        </section>

        <!-- Activities Section -->
        <section id="activities" class="py-20 md:py-32 px-6 sm:px-8 bg-brand-dark">
            <div class="container mx-auto max-w-6xl">
                <div class="reveal mb-12 text-center">
                    <h2 class="font-serif text-4xl font-bold text-white mb-4">Activities & Societies</h2>
                    <p class="font-sans text-lg text-brand-gray max-w-2xl mx-auto">Building discipline, resilience, and real-world impact beyond the classroom.</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- Technology Specialization -->
                    <div class="reveal" style="transition-delay: 0.3s;">
                        <div class="activity-card">
                            <h3 class="font-serif text-2xl text-white mb-2">Technology Specialization</h3>
                            <p class="text-brand-gray">Engaged in tech since 2019, with <span id="tech-duration" class="font-bold text-brand-light">0</span>+ years of experience. Began with 3D animation, Java, and Python before shifting to hardware, inspiring my focus in electrical engineering.</p>
                        </div>
                    </div>
                    <!-- Swimming -->
                    <div class="reveal" style="transition-delay: 0.4s;">
                        <div class="activity-card">
                            <h3 class="font-serif text-2xl text-white mb-2">Competitive Swimming</h3>
                            <p class="text-brand-gray">Dedicated <span id="swimming-duration" class="font-bold text-brand-light">0</span>+ years to high-level competitive swimming. This pursuit has instilled deep discipline and a relentless drive for improvement, translating to all areas of my life.</p>
                        </div>
                    </div>
                    <!-- Strength & Fitness -->
                    <div class="reveal" style="transition-delay: 0.5s;">
                        <div class="activity-card">
                            <h3 class="font-serif text-2xl text-white mb-2">Strength & Fitness</h3>
                            <p class="text-brand-gray">Committed to <span id="gym-duration" class="font-bold text-brand-light">0</span>+ years of consistent strength training. The gym is my proving ground for building physical and mental resilience, discipline, and a goal-oriented mindset.</p>
                        </div>
                    </div>
                </div>
                
                <div class="reveal mt-12 text-center">
                    <p class="font-sans text-lg text-brand-light">
                        Also an active member of <span class="font-bold">Enactus PW</span> (Project Leader), <span class="font-bold">AZS PW – Kickboxing</span>, and participant in the <span class="font-bold">Academic Championships of Poland</span>.
                    </p>
                </div>
            </div>
        </section>

        <!-- Ventures & Focus Section -->
        <section id="ventures" class="py-20 md:py-32 px-6 sm:px-8">
            <div class="container mx-auto max-w-6xl">
                <div class="reveal mb-12">
                    <h2 class="font-serif text-4xl font-bold text-white mb-4">Ventures & Focus</h2>
                    <p class="font-sans text-lg text-brand-gray max-w-3xl">
                        I specialize in social media business advertisement and lead generation. My venture, <a href="https://migmag-hvac-and-elevator.dorik.io/" target="_blank" rel="noopener noreferrer" class="text-brand-gold hover:underline">Migmag</a>, is dedicated to empowering smaller businesses, enabling them to thrive and make a lasting impact.
                    </p>
                </div>

                <div class="reveal">
                    <h3 class="font-serif text-2xl text-white mb-6">Core Skills</h3>
                    <div class="flex flex-wrap gap-4">
                        <span class="skill-badge">Social Media Marketing</span>
                        <span class="skill-badge">Lead Generation</span>
                        <span class="skill-badge">Email Copywriting</span>
                        <span class="skill-badge">Facebook Advertising</span>
                        <span class="skill-badge">Entrepreneurship</span>
                        <span class="skill-badge">Sales & Negotiation</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Contact Section -->
        <section id="contact" class="py-20 md:py-32 px-6 sm:px-8">
            <div class="container mx-auto max-w-3xl text-center">
                <div class="reveal mb-10">
                    <h2 class="font-serif text-4xl font-bold text-white mb-4">Interested to work with me?</h2>
                    <p class="font-sans text-lg text-brand-gray">
                        Drop a message to <a href="mailto:max.gum@migmag.pl" class="text-brand-gold hover:underline">max.gum@migmag.pl</a> or book a call.
                    </p>
                </div>
                <div class="reveal">
                    <a href="https://calendly.com/migmag/discoverycall" target="_blank" rel="noopener noreferrer" 
                       class="inline-block bg-brand-gold text-brand-dark font-bold py-4 px-10 rounded-full text-lg 
                              hover:bg-opacity-80 transition-all duration-300 shadow-lg shadow-brand-gold/20
                              hover:shadow-xl hover:shadow-brand-gold/30 hover:-translate-y-1">
                        Book a Call
                    </a>
                </div>
                
                <!-- Gemini Feature Button -->
                <div class="reveal mt-12">
                     <button id="open-gemini-modal" 
                             class="inline-block bg-transparent text-brand-gold font-bold py-4 px-10 rounded-full text-lg 
                                    border-2 border-brand-gold hover:bg-brand-gold hover:text-brand-dark
                                    transition-all duration-300 shadow-lg shadow-brand-gold/20
                                    hover:shadow-xl hover:shadow-brand-gold/30 hover:-translate-y-1">
                        ✨ Smart Inquiry
                    </button>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="py-12 px-6 sm:px-8 border-t border-gray-900">
        <div class="container mx-auto max-w-6xl text-center text-brand-gray flex flex-col sm:flex-row justify-between items-center">
            <p>&copy; <span id="footer-year">2025</span> Max Gum. All rights reserved.</p>
            
            <div class="flex items-center mt-4 sm:mt-0">
                <!-- LinkedIn Icon -->
                <a href="https://www.linkedin.com/in/maxgum/" target="_blank" rel="noopener noreferrer" class="text-brand-gray hover:text-brand-gold ml-6">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.85-3.037-1.85 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.557V9h3.562v11.452zM22.225 0H1.771C.79 0 0 .774 0 1.729v20.542C0 23.227.79 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.225 0z"></path>
                    </svg>
                    <span class="sr-only">LinkedIn</span>
                </a>
                
                <a href="https://migmag-hvac-and-elevator.dorik.io/" target="_blank" rel="noopener noreferrer" class="ml-6">Migmag</a>
            </div>
        </div>
    </footer>

    <!-- Gemini Modal -->
    <div id="gemini-modal-overlay" class="gemini-modal-overlay">
        <div id="gemini-modal" class="gemini-modal">
            <span id="gemini-modal-close" class="gemini-modal-close">&times;</span>
            <h3 class="font-serif text-3xl text-white mb-4">✨ AI Inquiry Draft</h3>
            <p class="text-brand-gray mb-6">Let AI help you draft a professional email to Max. Just state your purpose below.</p>
            
            <label for="gemini-input" class="text-brand-gray text-sm mb-2 block">What is your inquiry about?</label>
            <input id="gemini-input" type="text" class="gemini-input" placeholder="e.g., Marketing services, job offer, collaboration...">
            
            <button id="gemini-generate-btn" class="gemini-button w-full">
                <span id="gemini-generate-text">Generate Draft</span>
                <div id="gemini-generate-loader" class="gemini-spinner" style="display: none;"></div>
            </button>
            
            <div id="gemini-result-wrapper" class="mt-6" style="display: none;">
                <label for="gemini-textarea" class="text-brand-gray text-sm mb-2 block">Your Draft:</label>
                <textarea id="gemini-textarea" class="gemini-textarea" readonly></textarea>
                <button id="gemini-copy-btn" class="gemini-button secondary">
                    Copy to Clipboard
                    <span id="gemini-copy-feedback" class="ml-2" style="display: none;">Copied!</span>
                </button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Header Scroll Effect ---
            const header = document.querySelector('.header');
            const onScroll = () => {
                if (window.scrollY > 50) {
                    header.classList.add('header-scrolled');
                } else {
                    header.classList.remove('header-scrolled');
                }
            };
            window.addEventListener('scroll', onScroll, { passive: true });
            onScroll(); // Run on load

            // --- Scroll Animations ---
            const revealElements = document.querySelectorAll('.reveal');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Element is on screen, play animation
                        entry.target.classList.add('is-visible');
                    } else {
                        // Element is off screen.
                        // Reset if it's below the viewport.
                        if (entry.boundingClientRect.top > window.innerHeight) {
                            entry.target.classList.remove('is-visible');
                        }
                    }
                });
            }, {
                threshold: 0.1 // Trigger when 10% of the element is visible
            });

            revealElements.forEach(el => {
                observer.observe(el);
            });

            // --- Footer Year ---
            document.getElementById('footer-year').textContent = new Date().getFullYear();

            // --- Calculate Durations ---
            function calculateDuration(startDateStr) {
                const startDate = new Date(startDateStr);
                const now = new Date();
                let months = (now.getFullYear() - startDate.getFullYear()) * 12;
                months -= startDate.getMonth();
                months += now.getMonth();
                
                if (months <= 0) return 0;
                
                // Round to nearest half-year
                const years = months / 12;
                return (Math.round(years * 2) / 2).toFixed(1);
            }

            const swimmingDuration = calculateDuration('2022-12-01');
            const gymDuration = calculateDuration('2023-06-01');
            const techDuration = calculateDuration('2019-01-01');

            if(document.getElementById('swimming-duration')) {
                document.getElementById('swimming-duration').textContent = swimmingDuration;
            }
            if(document.getElementById('gym-duration')) {
                document.getElementById('gym-duration').textContent = gymDuration;
            }
            if(document.getElementById('tech-duration')) {
                document.getElementById('tech-duration').textContent = techDuration;
            }

            // --- Gemini Modal Logic ---
            const modalOverlay = document.getElementById('gemini-modal-overlay');
            const modal = document.getElementById('gemini-modal');
            const openBtn = document.getElementById('open-gemini-modal');
            const closeBtn = document.getElementById('gemini-modal-close');
            
            const generateBtn = document.getElementById('gemini-generate-btn');
            const generateText = document.getElementById('gemini-generate-text');
            const generateLoader = document.getElementById('gemini-generate-loader');
            
            const inputField = document.getElementById('gemini-input');
            const resultWrapper = document.getElementById('gemini-result-wrapper');
            const resultTextarea = document.getElementById('gemini-textarea');
            const copyBtn = document.getElementById('gemini-copy-btn');
            const copyFeedback = document.getElementById('gemini-copy-feedback');

            const API_KEY = ""; // Per instructions, leave empty.
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
            
            // Open Modal
            if (openBtn) {
                openBtn.addEventListener('click', () => {
                    modalOverlay.classList.add('is-visible');
                });
            }

            // Close Modal
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }
            if (modalOverlay) {
                modalOverlay.addEventListener('click', (e) => {
                    if (e.target === modalOverlay) {
                        closeModal();
                    }
                });
            }
            function closeModal() {
                if (modalOverlay) {
                    modalOverlay.classList.remove('is-visible');
                }
            }

            // Copy to Clipboard
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    try {
                        resultTextarea.select();
                        document.execCommand('copy'); // Use execCommand for iframe compatibility
                        copyFeedback.style.display = 'inline';
                        setTimeout(() => {
                            copyFeedback.style.display = 'none';
                        }, 2000);
                    } catch (err) {
                        console.error('Failed to copy text: ', err);
                    }
                });
            }

            // Generate Draft
            if (generateBtn) {
                generateBtn.addEventListener('click', async () => {
                    const inquiry = inputField.value.trim();
                    
                    // Clear previous validation
                    inputField.classList.remove('invalid');

                    if (!inquiry) {
                        // Show validation error
                        inputField.classList.add('invalid');
                        setTimeout(() => {
                            inputField.classList.remove('invalid');
                        }, 1500); // Remove error style after 1.5s
                        return;
                    }

                    setLoading(true);

                    const systemPrompt = `You are a professional assistant for Max Gum, an entrepreneur and engineering student. 
                    Your task is to draft a concise, polite, and professional initial email to Max based on a user's stated purpose. 
                    The user is a visitor on Max's portfolio. 
                    The draft should be ready to be copied and sent. 
                    - Address it "Hi Max,".
                    - Briefly state the purpose, based on the user's input.
                    - Keep it to 2-3 short sentences.
                    - End with a polite closing like "Best regards,".
                    - Do NOT include a placeholder for the sender's name (e.g., "[Your Name]"). The user will add that themselves.`;
                    
                    const userQuery = `The user's stated purpose is: "${inquiry}". Please draft the email.`;

                    const payload = {
                        contents: [{ parts: [{ text: userQuery }] }],
                        systemInstruction: {
                            parts: [{ text: systemPrompt }]
                        },
                    };

                    try {
                        const response = await fetchWithBackoff(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });

                        if (!response.ok) {
                            throw new Error(`API request failed with status ${response.status}`);
                        }

                        const result = await response.json();
                        const candidate = result.candidates?.[0];
                        if (candidate && candidate.content?.parts?.[0]?.text) {
                            const text = candidate.content.parts[0].text;
                            resultTextarea.value = text;
                            resultWrapper.style.display = 'block';
                        } else {
                            throw new Error("Invalid response structure from API.");
                        }

                    } catch (error) {
                        console.error("Gemini API call failed:", error);
                        resultTextarea.value = "Sorry, an error occurred while generating the draft. Please try again.";
                        resultWrapper.style.display = 'block';
                    } finally {
                        setLoading(false);
                    }
                });
            }

            function setLoading(isLoading) {
                if (isLoading) {
                    if (generateText) generateText.style.display = 'none';
                    if (generateLoader) generateLoader.style.display = 'block';
                    if (generateBtn) generateBtn.disabled = true;
                } else {
                    if (generateText) generateText.style.display = 'inline';
                    if (generateLoader) generateLoader.style.display = 'none';
                    if (generateBtn) generateBtn.disabled = false;
                }
            }

            // Exponential backoff retry logic
            async function fetchWithBackoff(url, options, maxRetries = 4, baseDelay = 1000) {
                let attempt = 0;
                while (attempt < maxRetries) {
                    try {
                        const response = await fetch(url, options);
                        if (response.status === 429 || response.status >= 500) {
                            // Retry on 429 (Too Many Requests) or 5xx server errors
                            throw new Error(`Retryable error: ${response.status}`);
                        }
                        return response; // Success
                    } catch (error) {
                        if (attempt === maxRetries - 1) {
                            throw error; // Max retries reached
                        }
                        const delay = baseDelay * Math.pow(2, attempt) + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        attempt++;
                    }
                }
                throw new Error("Max retries reached");
            }

        });
    </script>

</body>
</html>
